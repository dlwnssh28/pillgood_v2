{"ast":null,"code":"import { createElementVNode as _createElementVNode, vModelSelect as _vModelSelect, withDirectives as _withDirectives, vModelText as _vModelText, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createCommentVNode as _createCommentVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"main-container box-shadow\"\n};\nconst _hoisted_2 = /*#__PURE__*/_createElementVNode(\"h1\", {\n  class: \"text-melon\"\n}, \"회원 목록\", -1);\nconst _hoisted_3 = {\n  style: {\n    \"display\": \"flex\",\n    \"align-items\": \"center\"\n  }\n};\nconst _hoisted_4 = /*#__PURE__*/_createElementVNode(\"option\", {\n  value: \"\"\n}, \"- 선택 -\", -1);\nconst _hoisted_5 = /*#__PURE__*/_createElementVNode(\"option\", {\n  value: \"memberName\"\n}, \"회원명\", -1);\nconst _hoisted_6 = /*#__PURE__*/_createElementVNode(\"option\", {\n  value: \"email\"\n}, \"이메일\", -1);\nconst _hoisted_7 = [_hoisted_4, _hoisted_5, _hoisted_6];\nconst _hoisted_8 = [\"disabled\"];\nconst _hoisted_9 = {\n  class: \"line-table member-table\"\n};\nconst _hoisted_10 = /*#__PURE__*/_createElementVNode(\"thead\", null, [/*#__PURE__*/_createElementVNode(\"tr\", null, [/*#__PURE__*/_createElementVNode(\"th\", null, \"회원명\"), /*#__PURE__*/_createElementVNode(\"th\", null, \"이메일\"), /*#__PURE__*/_createElementVNode(\"th\", null, \"휴대폰번호\"), /*#__PURE__*/_createElementVNode(\"th\", null, \"성별\"), /*#__PURE__*/_createElementVNode(\"th\", null, \"가입일\"), /*#__PURE__*/_createElementVNode(\"th\", null, \"구독상태\"), /*#__PURE__*/_createElementVNode(\"th\", null, \"레벨\"), /*#__PURE__*/_createElementVNode(\"th\", null, \"쿠폰 발급\"), /*#__PURE__*/_createElementVNode(\"th\", null, \"관리\")])], -1);\nconst _hoisted_11 = {\n  key: 0\n};\nconst _hoisted_12 = [\"onUpdate:modelValue\"];\nconst _hoisted_13 = /*#__PURE__*/_createElementVNode(\"option\", {\n  value: \"\",\n  disabled: \"\"\n}, \"-쿠폰 선택-\", -1);\nconst _hoisted_14 = [\"value\"];\nconst _hoisted_15 = [\"onClick\"];\nconst _hoisted_16 = {\n  key: 1\n};\nconst _hoisted_17 = [\"onClick\"];\nconst _hoisted_18 = [\"onClick\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_hoisted_2, _createElementVNode(\"div\", _hoisted_3, [_withDirectives(_createElementVNode(\"select\", {\n    style: {\n      \"width\": \"150px\"\n    },\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.selectedFilter = $event)\n  }, _hoisted_7, 512), [[_vModelSelect, $data.selectedFilter]]), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $data.searchQuery = $event),\n    disabled: !$data.selectedFilter,\n    placeholder: \"검색어를 입력하세요\"\n  }, null, 8, _hoisted_8), [[_vModelText, $data.searchQuery]]), _createElementVNode(\"button\", {\n    class: \"small-btn\",\n    onClick: _cache[2] || (_cache[2] = (...args) => $options.resetFilters && $options.resetFilters(...args))\n  }, \"초기화\")]), _createElementVNode(\"table\", _hoisted_9, [_hoisted_10, _createElementVNode(\"tbody\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($options.filteredMembers, member => {\n    return _openBlock(), _createElementBlock(\"tr\", {\n      key: member.memberUniqueId\n    }, [_createElementVNode(\"td\", null, _toDisplayString(member.name), 1), _createElementVNode(\"td\", null, _toDisplayString(member.email), 1), _createElementVNode(\"td\", null, _toDisplayString(member.phoneNumber), 1), _createElementVNode(\"td\", null, _toDisplayString($options.genderText(member.gender)), 1), _createElementVNode(\"td\", null, _toDisplayString($options.formatDate(member.registrationDate)), 1), _createElementVNode(\"td\", null, _toDisplayString(member.subscriptionStatus ? '구독중' : '-'), 1), _createElementVNode(\"td\", null, _toDisplayString($options.levelText(member.memberLevel)), 1), _createElementVNode(\"td\", null, [!member.couponIssued ? (_openBlock(), _createElementBlock(\"div\", _hoisted_11, [_withDirectives(_createElementVNode(\"select\", {\n      \"onUpdate:modelValue\": $event => $data.selectedCoupons[member.memberUniqueId] = $event\n    }, [_hoisted_13, (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.activeCoupons, coupon => {\n      return _openBlock(), _createElementBlock(\"option\", {\n        key: coupon.couponId,\n        value: coupon.couponId\n      }, _toDisplayString(coupon.couponName), 9, _hoisted_14);\n    }), 128))], 8, _hoisted_12), [[_vModelSelect, $data.selectedCoupons[member.memberUniqueId]]]), _createElementVNode(\"button\", {\n      onClick: $event => $options.issueCoupon(member)\n    }, \"발급\", 8, _hoisted_15)])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_16, \" 발급 완료 \"))]), _createElementVNode(\"td\", null, [_createElementVNode(\"button\", {\n      class: \"small-btn\",\n      onClick: $event => $options.editMember(member)\n    }, \"수정\", 8, _hoisted_17), _createElementVNode(\"button\", {\n      class: \"small-btn\",\n      onClick: $event => $options.confirmDeleteMember(member.memberUniqueId)\n    }, \"삭제\", 8, _hoisted_18)])]);\n  }), 128))])])]);\n}","map":{"version":3,"names":["class","_createElementVNode","style","value","_hoisted_4","_hoisted_5","_hoisted_6","key","disabled","_createElementBlock","_hoisted_1","_hoisted_2","_hoisted_3","_cache","$event","$data","selectedFilter","_hoisted_7","searchQuery","placeholder","_hoisted_8","onClick","args","$options","resetFilters","_hoisted_9","_hoisted_10","_Fragment","_renderList","filteredMembers","member","memberUniqueId","_toDisplayString","name","email","phoneNumber","genderText","gender","formatDate","registrationDate","subscriptionStatus","levelText","memberLevel","couponIssued","_hoisted_11","selectedCoupons","_hoisted_13","_ctx","activeCoupons","coupon","couponId","couponName","_hoisted_14","_hoisted_12","issueCoupon","_hoisted_15","_hoisted_16","editMember","_hoisted_17","confirmDeleteMember","_hoisted_18"],"sources":["C:\\Users\\woori\\IdeaProjects\\pillgood_v2\\src\\frontend\\src\\views\\MemberList.vue"],"sourcesContent":["<template>\n  <div class=\"main-container box-shadow\">\n    <h1 class=\"text-melon\">회원 목록</h1>\n    <div style=\"display: flex; align-items: center\">\n      <select style=\"width:150px;\" v-model=\"selectedFilter\">\n        <option value=\"\">- 선택 -</option>\n        <option value=\"memberName\">회원명</option>\n        <option value=\"email\">이메일</option>\n      </select>\n      <input v-model=\"searchQuery\" :disabled=\"!selectedFilter\" placeholder=\"검색어를 입력하세요\">\n      <button class=\"small-btn\" @click=\"resetFilters\">초기화</button>\n    </div>\n    <table class=\"line-table member-table\">\n      <thead>\n        <tr>\n          <th>회원명</th>\n          <th>이메일</th>\n          <th>휴대폰번호</th>\n          <th>성별</th>\n          <th>가입일</th>\n          <th>구독상태</th>\n          <th>레벨</th>\n          <th>쿠폰 발급</th>\n          <th>관리</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"member in filteredMembers\" :key=\"member.memberUniqueId\">\n          <td>{{ member.name }}</td>\n          <td>{{ member.email }}</td>\n          <td>{{ member.phoneNumber }}</td>\n          <td>{{ genderText(member.gender) }}</td>\n          <td>{{ formatDate(member.registrationDate) }}</td>\n          <td>{{ member.subscriptionStatus ? '구독중' : '-' }}</td>\n          <td>{{ levelText(member.memberLevel) }}</td>\n          <td>\n            <div v-if=\"!member.couponIssued\">\n              <select v-model=\"selectedCoupons[member.memberUniqueId]\">\n                <option value=\"\" disabled>-쿠폰 선택-</option>\n                <option v-for=\"coupon in activeCoupons\" :key=\"coupon.couponId\" :value=\"coupon.couponId\">{{ coupon.couponName }}</option>\n              </select>\n              <button @click=\"issueCoupon(member)\">발급</button>\n            </div>\n            <div v-else>\n              발급 완료\n            </div>\n          </td>\n          <td>\n            <button class=\"small-btn\" @click=\"editMember(member)\">수정</button>\n            <button class=\"small-btn\" @click=\"confirmDeleteMember(member.memberUniqueId)\">삭제</button>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n  </div>\n</template>\n\n<script>\nimport { mapActions, mapGetters } from 'vuex';\nimport axios from '../axios'; // axios 인스턴스 가져오기\n\nexport default {\n  name: 'AdminMemberList',\n  data() {\n    return {\n      selectedFilter: '',\n      searchQuery: '',\n      selectedCoupons: {}\n    };\n  },\n  computed: {\n    ...mapGetters('member', ['members']),\n    ...mapGetters('coupon', ['activeCoupons']),\n    filteredMembers() {\n      let members = this.members;\n\n      if (this.selectedFilter && this.searchQuery) {\n        const query = this.searchQuery.toLowerCase();\n        members = members.filter(member => {\n          if (this.selectedFilter === 'memberName') {\n            return member.name && member.name.toLowerCase().includes(query);\n          } else if (this.selectedFilter === 'email') {\n            return member.email && member.email.toLowerCase().includes(query);\n          }\n          return true;\n        });\n      }\n\n      return members.sort((a, b) => new Date(b.registrationDate) - new Date(a.registrationDate));\n    }\n  },\n  async created() {\n    await this.checkLoginStatus();\n    await this.fetchMembers();\n    await this.fetchActiveCoupons();\n  },\n  methods: {\n    ...mapActions('member', {\n      checkLoginStatus: 'checkLoginStatus',\n      fetchMembers: 'fetchMembers',\n      deleteMemberFromStore: 'deleteMember',\n      setEditingMember: 'setEditingMember'\n    }),\n    ...mapActions('coupon', ['fetchActiveCoupons']),\n    formatDate(date) {\n      const options = { year: 'numeric', month: '2-digit', day: '2-digit' };\n      return new Date(date).toLocaleDateString(undefined, options);\n    },\n    resetFilters() {\n      this.selectedFilter = '';\n      this.searchQuery = '';\n    },\n    editMember(member) {\n      this.setEditingMember(member);\n      this.$router.push('/memberedit');\n    },\n    async confirmDeleteMember(memberId) {\n      if (confirm('정말로 이 회원을 삭제하시겠습니까?')) {\n        await this.deleteMemberFromStore(memberId);\n        await this.fetchMembers();\n      }\n    },\n    genderText(gender) {\n      if (gender === 'F') return '여성';\n      if (gender === 'M') return '남성';\n      return '알 수 없음';\n    },\n    levelText(memberLevel) {\n      if (memberLevel === 'ADMIN') return '관리자';\n      if (memberLevel === 'USER') return '-';\n    },\n    async issueCoupon(member) {\n      const couponId = this.selectedCoupons[member.memberUniqueId];\n      if (!couponId) {\n        alert('쿠폰을 선택해주세요.');\n        return;\n      }\n\n      const ownedCoupon = {\n        memberUniqueId: member.memberUniqueId,\n        couponId,\n        issuedDate: new Date().toISOString(),\n        expiryDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),\n        couponUsed: false\n      };\n      console.log('발급 요청 데이터:', ownedCoupon); // 요청 데이터 확인용 로그\n\n      try {\n        await axios.post('/admin/ownedcoupons/create', ownedCoupon);\n        await axios.put(`/api/members/updateCouponIssued/${member.memberUniqueId}`, { couponIssued: true });\n        member.couponIssued = true;\n        this.$forceUpdate(); // 뷰 업데이트 강제 적용\n        alert('쿠폰이 발급되었습니다.');\n      } catch (error) {\n        console.error('쿠폰 발급 실패:', error);\n        alert('쿠폰 발급에 실패했습니다.');\n      }\n    }\n  }\n};\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}