{"ast":null,"code":"import { openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-d47b5ae4\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"main-container\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"loading\"\n};\nconst _hoisted_3 = {\n  key: 1,\n  class: \"box-container box-shadow\"\n};\nconst _hoisted_4 = {\n  class: \"text-melon\"\n};\nconst _hoisted_5 = {\n  key: 0\n};\nconst _hoisted_6 = {\n  class: \"result-table table-borderless\"\n};\nconst _hoisted_7 = {\n  class: \"def-container\"\n};\nconst _hoisted_8 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"hr\", {\n  class: \"line\"\n}, null, -1));\nconst _hoisted_9 = {\n  class: \"text-melon\"\n};\nconst _hoisted_10 = {\n  class: \"product-container\"\n};\nconst _hoisted_11 = {\n  class: \"product-item box-shadow\"\n};\nconst _hoisted_12 = [\"src\"];\nconst _hoisted_13 = [\"disabled\", \"onClick\"];\nconst _hoisted_14 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"h4\", {\n  class: \"text-melon\"\n}, \"나이대별 부족한 영양소 통계\", -1));\nconst _hoisted_15 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"h4\", {\n  class: \"text-melon\"\n}, \"고객 선호 제품\", -1));\nconst _hoisted_16 = {\n  key: 1\n};\nconst _hoisted_17 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"p\", null, \"설문 결과를 불러오는 중입니다...\", -1));\nconst _hoisted_18 = [_hoisted_17];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_router_link = _resolveComponent(\"router-link\");\n  const _component_AgeGroupDeficiencyChart = _resolveComponent(\"AgeGroupDeficiencyChart\");\n  const _component_AgeGroupTopProducts = _resolveComponent(\"AgeGroupTopProducts\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [$setup.isLoading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, \"Loading...\")) : (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_createElementVNode(\"h4\", _hoisted_4, _toDisplayString($setup.surveyResult?.name) + \" 님의 설문 조사 결과\", 1), $setup.surveyResult ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_createElementVNode(\"table\", _hoisted_6, [_createElementVNode(\"tr\", null, [_createElementVNode(\"td\", null, _toDisplayString($setup.surveyResult.age) + \" 세 | ( \" + _toDisplayString($setup.genderDisplay) + \" ) | \" + _toDisplayString($setup.surveyResult.height) + \" cm / \" + _toDisplayString($setup.surveyResult.weight) + \" kg ( BMI: \" + _toDisplayString($setup.calculateBMI($setup.surveyResult.weight, $setup.surveyResult.height)) + \" )\", 1)])]), _createElementVNode(\"div\", _hoisted_7, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.uniqueDeficiencies, (deficiency, index) => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: index,\n      class: \"def-id\"\n    }, [_createElementVNode(\"h4\", null, \"#\" + _toDisplayString($setup.getDeficiencyName(deficiency)), 1)]);\n  }), 128))]), _hoisted_8, _createElementVNode(\"h4\", _hoisted_9, _toDisplayString($setup.surveyResult?.name) + \" 님을 위한 추천 제품\", 1), _createElementVNode(\"div\", _hoisted_10, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.recommendedProducts, (product, index) => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: index,\n      class: \"product-grid-item\"\n    }, [_createElementVNode(\"div\", _hoisted_11, [_createVNode(_component_router_link, {\n      to: {\n        name: 'ProductDetail',\n        params: {\n          id: product.productId\n        }\n      }\n    }, {\n      default: _withCtx(() => [_createElementVNode(\"img\", {\n        src: product.productImage,\n        alt: \"productImg\",\n        class: \"product-image\"\n      }, null, 8, _hoisted_12), _createElementVNode(\"h5\", null, _toDisplayString(product.productName), 1)]),\n      _: 2\n    }, 1032, [\"to\"]), _createElementVNode(\"button\", {\n      disabled: $setup.isAddedToCart[product.productId],\n      onClick: $event => $setup.addToCart(product.productId),\n      class: \"btn btn-green\"\n    }, _toDisplayString($setup.isAddedToCart[product.productId] ? \"담겼습니다 ✅\" : \"장바구니에 담기\"), 9, _hoisted_13)])]);\n  }), 128))]), _hoisted_14, _createVNode(_component_AgeGroupDeficiencyChart, {\n    userAge: $setup.surveyResult.age\n  }, null, 8, [\"userAge\"]), _hoisted_15, _createVNode(_component_AgeGroupTopProducts)])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_16, _hoisted_18))]))]);\n}","map":{"version":3,"names":["class","key","_createElementVNode","_hoisted_17","_createElementBlock","_hoisted_1","$setup","isLoading","_hoisted_2","_hoisted_3","_hoisted_4","_toDisplayString","surveyResult","name","_hoisted_5","_hoisted_6","age","genderDisplay","height","weight","calculateBMI","_hoisted_7","_Fragment","_renderList","uniqueDeficiencies","deficiency","index","getDeficiencyName","_hoisted_8","_hoisted_9","_hoisted_10","recommendedProducts","product","_hoisted_11","_createVNode","_component_router_link","to","params","id","productId","default","_withCtx","src","productImage","alt","_hoisted_12","productName","_","disabled","isAddedToCart","onClick","$event","addToCart","_hoisted_13","_hoisted_14","_component_AgeGroupDeficiencyChart","userAge","_hoisted_15","_component_AgeGroupTopProducts","_hoisted_16","_hoisted_18"],"sources":["C:\\Users\\woori\\IdeaProjects\\pillgood_v2\\src\\frontend\\src\\views\\SurveyResultView.vue"],"sourcesContent":["<template>\n  <div class=\"main-container\">\n    <div v-if=\"isLoading\" class=\"loading\">Loading...</div>\n    <div v-else class=\"box-container box-shadow\">\n      <h4 class=\"text-melon\">{{ surveyResult?.name }} 님의 설문 조사 결과</h4>\n      <div v-if=\"surveyResult\">\n        <table class=\"result-table table-borderless\">\n          <tr>\n            <td>{{ surveyResult.age }} 세 | \n              ( {{ genderDisplay }} ) | \n              {{ surveyResult.height }} cm / {{ surveyResult.weight }} kg\n              ( BMI: {{ calculateBMI(surveyResult.weight, surveyResult.height) }} )</td>\n          </tr>\n        </table>\n        <div class=\"def-container\">\n          <div v-for=\"(deficiency, index) in uniqueDeficiencies\" :key=\"index\" class=\"def-id\">\n            <h4>#{{ getDeficiencyName(deficiency) }}</h4>\n          </div>\n        </div>\n        <hr class=\"line\">\n        <h4 class=\"text-melon\">{{ surveyResult?.name }} 님을 위한 추천 제품</h4>\n        <div class=\"product-container\">\n          <div v-for=\"(product, index) in recommendedProducts\" :key=\"index\" class=\"product-grid-item\">\n            <div class=\"product-item box-shadow\">\n              <router-link :to=\"{ name: 'ProductDetail', params: { id: product.productId } }\">\n                <img :src=\"product.productImage\" alt=\"productImg\" class=\"product-image\">\n                <h5>{{ product.productName }}</h5>\n              </router-link>\n              <button \n                :disabled=\"isAddedToCart[product.productId]\"\n                @click=\"addToCart(product.productId)\"\n                class=\"btn btn-green\">\n                {{ isAddedToCart[product.productId] ? \"담겼습니다 ✅\" : \"장바구니에 담기\" }}\n              </button>\n            </div>\n          </div>\n        </div>\n        <!-- 추가된 부분 시작 -->\n        <h4 class=\"text-melon\">나이대별 부족한 영양소 통계</h4>\n        <AgeGroupDeficiencyChart :userAge=\"surveyResult.age\" />\n        <!-- 추가된 부분 끝 -->\n        <!-- AgeGroupTopProducts 추가 -->\n        <h4 class=\"text-melon\">고객 선호 제품</h4>\n        <AgeGroupTopProducts />\n      </div>\n      <div v-else>\n        <p>설문 결과를 불러오는 중입니다...</p>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { computed, onMounted, reactive } from 'vue';\nimport { useStore } from 'vuex';\nimport { useRouter } from 'vue-router';\nimport AgeGroupDeficiencyChart from '@/components/AgeGroupDeficiencyChart'; // 추가된 부분\nimport AgeGroupTopProducts from '@/components/AgeGroupTopProducts'; // 추가된 부분\n\nexport default {\n  name: 'SurveyResultView',\n  components: {\n    AgeGroupDeficiencyChart, // 추가된 부분\n    AgeGroupTopProducts // 추가된 부분\n  },\n  setup() {\n    const store = useStore();\n    const router = useRouter();\n    const isLoading = computed(() => store.state.survey.isLoading);\n    const surveyResult = computed(() => store.getters['survey/surveyResult']);\n    const recommendedProducts = computed(() => store.getters['survey/recommendedProducts']);\n    const deficiencies = computed(() => store.getters['deficiency/deficiencies']);\n    const isAddedToCart = reactive({});\n\n    const calculateBMI = (weight, height) => {\n      if (!weight || !height) return 'N/A';\n      const heightInMeters = height / 100;\n      return (weight / (heightInMeters * heightInMeters)).toFixed(2);\n    };\n\n    const getDeficiencyName = (id) => {\n      const deficiency = deficiencies.value?.find(def => def.deficiencyId === id);\n      return deficiency ? deficiency.deficiencyName : 'Unknown';\n    };\n\n    const uniqueDeficiencies = computed(() => {\n      const ids = [surveyResult.value?.deficiencyId1, surveyResult.value?.deficiencyId2, surveyResult.value?.deficiencyId3];\n      return [...new Set(ids)].filter(id => id !== null); // 중복 제거 및 null 필터링\n    });\n\n    const genderDisplay = computed(() => {\n      if (surveyResult.value?.gender === 'M') return '남';\n      if (surveyResult.value?.gender === 'F') return '여';\n      return '';\n    });\n\n    onMounted(async () => {\n      const memberId = store.state.member.memberId;\n      console.log('memberId:', memberId);\n      await store.dispatch('survey/loadSurveyResult', memberId);\n      console.log('surveyResult:', surveyResult.value);\n\n      if (!surveyResult.value) {\n        alert(\"설문 결과가 없습니다!\");\n        router.push(\"/survey\");\n        return;\n      }\n\n      await store.dispatch('deficiency/fetchDeficiencies');\n      await store.dispatch('product/fetchProducts');\n      await store.dispatch('survey/fetchProductsByDeficiency', uniqueDeficiencies.value);\n      console.log('recommendedProducts after fetch:', store.getters['survey/recommendedProducts']);\n\n      await store.dispatch('survey/fetchAgeGroupDeficiencyData'); // 추가된 부분\n      await store.dispatch('survey/fetchTopProductsByAgeGroup'); // 추가된 부분\n    });\n\n    const addToCart = async (productId) => {\n      try {\n        const cartItem = {\n          productId,\n          productQuantity: 1\n        };\n        const response = await store.dispatch('cart/addToCart', cartItem);\n        if (response.status === 201) {\n          isAddedToCart[productId] = true;\n        }\n      } catch (error) {\n        console.error('Error adding to cart:', error);\n      }\n    };\n\n    return {\n      isLoading,\n      surveyResult,\n      recommendedProducts,\n      calculateBMI,\n      getDeficiencyName,\n      uniqueDeficiencies,\n      genderDisplay,\n      isAddedToCart,\n      addToCart\n    };\n  }\n};\n</script>\n\n<style scoped>\n@import '../assets/styles.css';\n\n.result-table {\n  border: 0;\n}\n\n.def-container {\n  margin-top: 10px;\n  margin-bottom: 30px;\n  padding: 10px;\n  display: flex;\n  gap: 20px;\n  justify-content: center;\n}\n\n.def-id {\n  background-color: #B4D9A9;\n  padding: 20px;\n  text-align: center;\n  border-radius: 35px; /* 둥근 모서리 추가 */\n  display: inline-block;\n  white-space: nowrap;\n}\n\n.def-id h4 {\n  color: white;\n  margin: 0;\n  display: inline;\n}\n\n.product-container {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n  gap: 20px;\n  padding: 10px;\n}\n\n.product-grid-item {\n  display: flex;\n  justify-content: center;\n}\n\n.product-item {\n  width: 100%;\n  padding: 7px;\n  text-align: center;\n  justify-content: center;\n}\n\n.product-image {\n  width: 100%;\n  height: auto;\n  display: block;\n  margin-bottom: 10px;\n}\n\n.btn {\n  margin-top: 10px;\n  display: inline-block;\n}\n\n/* 반응형 디자인을 위한 미디어 쿼리 */\n@media (max-width: 600px) {\n  .def-container {\n    grid-template-columns: 1fr; /* 화면이 좁아지면 세로 배열 */\n  }\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}